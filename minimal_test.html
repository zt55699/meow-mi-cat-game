<!DOCTYPE html>
<html>
<head>
    <title>Minimal Timer Test</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
</head>
<body>
    <div id="test-results"></div>
    <div id="game"></div>

    <script>
        const results = document.getElementById('test-results');
        
        function logResult(message, color = 'black') {
            const div = document.createElement('div');
            div.style.color = color;
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            results.appendChild(div);
            console.log(message);
        }

        let timerFireCount = 0;
        let gameStarted = false;

        const config = {
            type: Phaser.AUTO,
            width: 400,
            height: 300,
            parent: 'game',
            scene: {
                create: function() {
                    logResult('Scene created', 'blue');
                    
                    // Auto-start like in fixed meow_mi
                    if (window.autoStartAfterRestart) {
                        logResult('Auto-starting after restart...', 'orange');
                        window.autoStartAfterRestart = false;
                        const scene = this;
                        setTimeout(() => {
                            startTestGame(scene);
                        }, 100);
                    } else {
                        // Manual start
                        const startBtn = this.add.text(200, 100, 'START', {
                            fontSize: '20px',
                            fill: '#00ff00',
                            backgroundColor: '#000000',
                            padding: { x: 10, y: 5 }
                        });
                        startBtn.setOrigin(0.5);
                        startBtn.setInteractive();
                        startBtn.on('pointerdown', () => {
                            startBtn.destroy();
                            startTestGame(this);
                        });
                    }
                    
                    // Add restart button
                    const restartBtn = this.add.text(200, 200, 'RESTART', {
                        fontSize: '20px',
                        fill: '#ff0000',
                        backgroundColor: '#ffffff',
                        padding: { x: 10, y: 5 }
                    });
                    restartBtn.setOrigin(0.5);
                    restartBtn.setInteractive();
                    
                    restartBtn.on('pointerdown', () => {
                        logResult('Restarting scene...', 'orange');
                        gameStarted = false;
                        timerFireCount = 0;
                        window.autoStartAfterRestart = true;
                        this.scene.restart();
                    });
                }
            }
        };

        function startTestGame(scene) {
            logResult('Starting test game...', 'green');
            gameStarted = true;
            
            // Clear existing timers like in meow_mi
            scene.time.removeAllEvents();
            
            // Create timer exactly like in meow_mi (fixed version)
            const testTimer = scene.time.addEvent({
                delay: 1000,
                callback: function() {
                    timerFireCount++;
                    logResult(`âœ… Timer fired #${timerFireCount} at time ${scene.time.now}`, 'green');
                },
                callbackScope: scene,
                loop: true
            });
            
            logResult(`Timer created: ${!!testTimer}, delay: ${testTimer.delay}, loop: ${testTimer.loop}`);
        }

        const game = new Phaser.Game(config);
        logResult('Test initialized - click START, then RESTART to test timer persistence');
    </script>
</body>
</html>